<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sản phẩm - Mazer Admin Dashboard</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/bootstrap.css">

    <link rel="shortcut icon" href="../assets/images/favicon.svg" type="image/x-icon">

    <link rel="stylesheet" href="../assets/vendors/simple-datatables/style.css">

    <link rel="stylesheet" href="../assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="../assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="../assets/css/app.css">
    <link rel="stylesheet" href="product-preview-style.css">
</head>


<body>
    <div id="app">
        <div id="sidebar" class="active">
            <script src="../menu/menu_loader.js"></script>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>Quản lí sản phẩm</h3>
                            <p class="text-subtitle text-muted">Quản lí các sản phẩm</p>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="../index.html">Dashboard</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">DataTable</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
                <section class="section">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="card-title">Tạo sản phẩm mới</h6>
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                data-bs-target="#createProductForm">
                                <span>Tạo sản phẩm</span>
                            </button>
                        </div>
                        <div id="createProductForm" class="collapse">
                            <div class="card-body">
                                <form id="productForm" enctype="multipart/form-data">
                                    <!-- Basic Information -->
                                    <div class="form-section">
                                        <h6><i class="bi bi-info-circle"></i> Thông tin sản phẩm</h6>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="name" class="form-label">Tên sản phẩm <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="name" name="name" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="brand" class="form-label">Thương hiệu <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="brand" name="brand"
                                                    required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="price" class="form-label">Giá <span
                                                        class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <span class="input-group-text">vnd</span>
                                                    <input type="number" class="form-control" id="price" name="price"
                                                        step="1000" min="0" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="release_date" class="form-label">Ngày phát hành <span
                                                        class="text-danger">*</span></label>
                                                <input type="date" class="form-control" id="release_date"
                                                    name="release_date" placeholder="e.g., January 2024" required>
                                            </div>
                                            <div class="col-12 mb-3">
                                                <label for="description" class="form-label">Mô tả <span
                                                        class="text-danger">*</span></label>
                                                <textarea class="form-control" id="description" name="description"
                                                    rows="3" required></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Product Images -->
                                    <div class="form-section">
                                        <h6><i class="bi bi-images"></i> Hình ảnh sản phẩm</h6>
                                        <div class="mb-3">
                                            <label for="files" class="form-label">Chọn ảnh<span
                                                    class="text-danger">*</span></label>
                                            <input type="file" class="form-control" id="files" name="files" multiple
                                                accept="image/*">
                                            <small class="text-muted">Ảnh đầu tiên sẽ là ảnh chính của sản phẩm</small>
                                        </div>
                                        <div id="imagePreview" class="image-preview"></div>
                                        <script src="image-previewer.js"></script>
                                    </div>

                                    <!-- Technical Specifications -->
                                    <div class="form-section">
                                        <h6><i class="bi bi-cpu"></i> Thông số kỹ thuật</h6>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="os" class="form-label">Hệ điều hành <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="os" name="os" required>
                                                <small class="text-muted">eg. Android 14</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="cpu" class="form-label">CPU <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="cpu" name="cpu" required>
                                                <small class="text-muted">e.g., Snapdragon 8 Gen 3</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="cpu_speed" class="form-label">Tốc độ CPU <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="cpu_speed" name="cpu_speed"
                                                    required>
                                                <small class="text-muted">e.g., 3.2 GHz</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="gpu" class="form-label">GPU <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="gpu" name="gpu" required>
                                                <small class="text-muted">e.g., Adreno 750</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="ram" class="form-label">RAM <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="ram" name="ram" required>
                                                <small class="text-muted">e.g., 12GB</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="storage_cap" class="form-label">Dung lượng lưu trữ <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="storage_cap"
                                                    name="storage_cap" required>
                                                <small class="text-muted">e.g., 256GB</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Camera & Display -->
                                    <div class="form-section">
                                        <h6><i class="bi bi-camera"></i> Camera & Hiển thị</h6>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="rear_cam" class="form-label">Camera sau <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="rear_cam" name="rear_cam"
                                                    required>
                                                <small class="text-muted">e.g., 50MP + 12MP + 10MP</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="front_cam" class="form-label">Camera trước<span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="front_cam" name="front_cam"
                                                    required>
                                                <small class="text-muted">e.g., 12MP</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="screen_res" class="form-label">Độ phân giải màn hình<span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="screen_res"
                                                    name="screen_res" required>
                                                <small class="text-muted">e.g., 2340 x 1080 pixels</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="battery_cap" class="form-label">Dung lượng pin <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="battery_cap"
                                                    name="battery_cap" required>
                                                <small class="text-muted">e.g., 5000 mAh</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Physical Specifications -->
                                    <div class="form-section">
                                        <h6><i class="bi bi-phone"></i> Thông số vật lý</h6>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="material" class="form-label">Vật liệu <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="material" name="material"
                                                    required>
                                                <small class="text-muted">e.g., khung nhôm</small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="size_weight" class="form-label">Kích thước và cân nặng <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="size_weight"
                                                    name="size_weight" required>
                                                <small class="text-muted">e.g., 159.9 x 76.7 x 8.9 mm, 228g</small>
                                            </div>
                                            <div class="col-12 mb-3">
                                                <label for="features" class="form-label">Tính năng <span
                                                        class="text-danger">*</span></label>
                                                <textarea class="form-control" id="features" name="features" rows="2"
                                                    required></textarea>
                                                <small class="text-muted">e.g., 5G, NFC, Cảm biến vân tay, Mở khóa bằng
                                                    khuôn mặt</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Submit Buttons -->
                                    <div class="d-flex justify-content-end gap-2">
                                        <button type="button" class="btn btn-secondary" data-bs-toggle="collapse"
                                            data-bs-target="#createProductForm">
                                            Huỷ
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            OK
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="section">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Sản phẩm</span>
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-funnel"></i> Lọc
                            </button>
                        </div>
                        <div class="card-body">
                            <table class="table table-hover align-middle" id="table1">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox"></th>
                                        <th>Sản phẩm</th>
                                        <th>Tên sản phẩm</th>
                                        <th>Thương hiệu</th>
                                        <th>Ngày phát hành</th>
                                        <th>Giá bán</th>
                                        <th>Lượt xem</th>
                                        <th>Bình luận</th>
                                        <th>Trạng thái</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><input type="checkbox"></td>
                                        <td>
                                            <img style="width: 80px; height: 100px; object-fit: cover;"
                                                src="../assets/images/bg/4853433.jpg" alt="Ảnh sản phẩm">
                                        </td>
                                        <td>Samsung Galaxy S100</td>
                                        <td>Samsung</td>
                                        <td>17/10/2025</td>
                                        <td>999,999 vnd</td>
                                        <td>120</td>
                                        <td>5</td>
                                        <td>
                                            <span class="badge bg-success">Active</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-outline-primary btn-sm"><i
                                                    class="bi bi-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-warning"><i
                                                    class="bi bi-pencil"></i></button>
                                            <button class="btn btn-sm btn-outline-danger"><i
                                                    class="bi bi-trash"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><input type="checkbox"></td>
                                        <td>
                                            <img style="width: 80px; height: 100px; object-fit: cover;"
                                                src="https://res.cloudinary.com/dvxbjkujw/image/upload/v1760507775/products/fg85n2bwix7bgsjjp3u2.jpg"
                                                alt="Ảnh sản phẩm">
                                        </td>
                                        <td>Samsung S200</td>
                                        <td>Apple</td>
                                        <td>17/10/2025</td>
                                        <td>999,999 vnd</td>
                                        <td>120</td>
                                        <td>5</td>
                                        <td>
                                            <span class="badge bg-success">Active</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-info"><i
                                                    class="bi bi-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-warning"><i
                                                    class="bi bi-pencil"></i></button>
                                            <button class="btn btn-sm btn-outline-danger"><i
                                                    class="bi bi-trash"></i></button>
                                        </td>
                                    </tr>
                                    <!-- Thêm các dòng sản phẩm khác tại đây -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>

            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>2021 &copy; Mazer</p>
                    </div>
                    <div class="float-end">
                        <p>Crafted with <span class="text-danger"><i class="bi bi-heart"></i></span> by <a
                                href="http://ahmadsaugi.com">A. Saugi</a></p>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script src="../assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="../assets/js/bootstrap.bundle.min.js"></script>

    <script src="../assets/vendors/simple-datatables/simple-datatables.js"></script>
    <script>
        // Simple Datatable
        let table1 = document.querySelector('#table1');
        let dataTable = new simpleDatatables.DataTable(table1);
    </script>

    <script src="../assets/js/main.js"></script>

    <!-- Image preview - Add this before closing body tag -->
    <div class="modal fade" id="imageModal" tabindex="-1" onclick="closeImageModal()">
        <div class="modal-dialog modal-dialog-centered modal-lg" onclick="event.stopPropagation()">
            <div class="modal-content">
                <img id="modalImage" src="" alt="Full view">
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../services/product-service.js"></script>


    <script>
        async function loadProducts(page = 0, size = 10) {
            try {
                const res = await axios.get(`http://localhost:8082/api/products?page=${page}&size=${size}`);
                const data = res.data;
                const products = data?.content ?? [];
                console.log(data);
                console.log(products);

                if (!Array.isArray(products)) {
                    console.error("API không đúng format Page<T>:", data);
                    return;
                }

                const tbody = document.querySelector('#table1 tbody');
                tbody.innerHTML = '';

                products.forEach(p => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
        <td><input type="checkbox"></td>
        <td>
            <img style="width: 80px; height: 100px; object-fit: cover;"
                src="${p.imageUrl ?? '/assets/images/placeholder.png'}" alt="Ảnh sản phẩm">
        </td>
        <td>${p.name}</td>
        <td>---</td> <!-- brand chưa có -->
        <td>---</td> <!-- releaseDate chưa có -->
        <td>${formatPrice(p.discountedPrice ?? p.price)} vnd</td>
        <td>---</td> <!-- view count -->
        <td>---</td> <!-- comments -->
        <td><span class="badge bg-success">Active</span></td>
        <td>
            <button class="btn btn-outline-primary btn-sm"><i class="bi bi-eye"></i></button>
            <button class="btn btn-sm btn-outline-warning"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
        </td>
    `;
                    tbody.appendChild(row);
                });


            } catch (err) {
                console.error("Lỗi khi load sản phẩm", err);
                if (err.response) {
                    console.error("Backend trả về:", err.response.data);
                }
            }
        }

        function formatPrice(value) {
    if (!value && value !== 0) return '0';
    return Number(value).toLocaleString('vi-VN'); // ví dụ: 1000000 → "1.000.000"
}


        document.addEventListener('DOMContentLoaded', () => loadProducts());
    </script>
</body>

</html>